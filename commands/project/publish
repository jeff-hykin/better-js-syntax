#!/usr/bin/env bash
path="$FORNIX_FOLDER"
if [ -z "$FORNIX_FOLDER" ]
then
    path="$0/../.."
fi

rm -rf "$path/autogenerated/package.vsix"
vsce package --out "$path/autogenerated/package.vsix" && echo "packaged VSCE"
vsce publish --pat "$1" && echo "published on VSCE"
ovsx publish -p "$2" && echo "published on OVSX"

tag_name="$(jq '.version' ./package.json)"
git tag "$tag_name" && git push origin "$tag_name"

code --install-extension "$path/autogenerated/package.vsix" && echo "installed package"